# ------------------- General Options -------------------------

description                  : AgentFormer (Before DLow)
results_root_dir             : results
seed                         : 10
dataset                      : nuscenes_pred
data_root_ethucy             : datasets/eth_ucy
data_root_nuscenes_pred      : datasets/nuscenes_pred
load_map                     : true
map_version                  : 0.1

# ------------------- Feature Extractor -------------------------

past_frames                  : 4
future_frames                : 12
min_past_frames              : 2
min_future_frames            : 12

traj_scale                   : 10
motion_dim                   : 2
forecast_dim                 : 2

# ------------------- Model -------------------------

model_id: agentformer
tf_version: v2
tf_model_dim: 256
tf_ff_dim: 512
tf_nhead: 8
tf_dropout: 0.1
input_type: ['scene_norm', 'vel', 'heading', 'map']
fut_input_type: ['scene_norm', 'vel', 'heading', 'map']
dec_input_type: ['heading', 'map']
pred_type: 'scene_norm'
sn_out_type: 'norm'
pos_concat: true
rand_rot_scene: true

use_map: true
map_encoder:
  model_id: map_cnn
  normalize: true
  hdim: [32, 32, 32, 1]
  kernels: [5, 5, 5, 3]
  strides: [2, 2, 1, 1]
  out_dim: 32
  dropout: 0.0

context_encoder:
  nlayer: 2

future_decoder:
  nlayer: 2
  out_mlp_dim: [512, 256]

future_encoder:
  nlayer: 2

# ------------------- VAE-------------------------

nz                           : 2
sample_k                     : 5
learn_prior                  : false

# ------------------- Training Parameters -------------------------

lr                           : 1.e-4
loss_cfg:
  mse:
    weight: 1.0
  kld:
    weight: 1.0
    min_clip: 2.0
  sample:
    weight: 1.0
    k: 5
  op: # oracle preference
    weight: 16.0
    k: 2 # use how many samples for comparison
    oracles:
      ade                     : false
      ade_batch               : false
      fde                     : false
      fde_batch               : false
      avg_vel                 : true
      min_gap                 : false
    assign_tailored_dims      : false
    assign_user_dims          : true
    mask_insignificant_comp   : true
    dominant_only             : true
    average_strategy          : 'weight' # 'none', `weight` or `softmax`


num_epochs                   : 50
lr_fix_epochs                : 10
lr_scheduler: 'step'
decay_step: 10
decay_gamma: 0.5
print_freq                   : 20
model_save_freq              : 10

# ---- Training with oracle preference ----

twop                         : true
twop_sample_z_from_hc_set    : false
twop_get_z_strategy          : 'z_gt_post_sample'
#       `z_gt_post_sample`
#       `z_re_post_sample`
#       `z_re_post_mean`
#       `z_re_post_mode`
user_give_z_at_test          : true
print_csv                    : true

pretrain                     : false
add_loss_eps                 : 20 # After how many epochs to add the preference loss

external_assign_z_at_test    : true

z_type                       : 'beta'
